name: üåü TreeOM Quantum Sync

on:
  # –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ –≤–µ—Ç–∫–µ main
  push:
    branches:
      - main
    paths:
      - "index.html"
      - ".github/workflows/**"
      - ".github/workflows/artifact_sync.json"

  # –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
  schedule:
    - cron: "*/15 * * * *"

  # –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub Actions
  workflow_dispatch:

jobs:
  sync-and-validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10

      - name: Check if requirements.txt exists
        id: check-requirements
        run: |
          if [ ! -f requirements.txt ]; then
            echo "requirements.txt not found!"; exit 1;
          fi

      - name: Install dependencies
        if: steps.check-requirements.outcome == 'success'
        run: |
          pip install -r requirements.txt

      - name: Validate GuardianFilter
        run: |
          python scripts/validate_filter.py filters/GuardianFilter_OM.json artifact_sync.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Sync artifacts
        run: |
          python scripts/sync_artifacts.py